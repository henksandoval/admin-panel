<div
  class="nav-item-wrapper"
  [class.level-0]="level() === 0"
  [class.collapsed]="sidebarCollapsed()">

  @if (item().type === 'collapsable') {
    <div
      class="nav-item nav-collapsable"
      [class.has-submenu]="showSubmenu()"
      [style.padding-left]="sidebarCollapsed() && level() === 0 ? '12px' : getPaddingLeft()"
      (click)="toggleCollapse()"
      (mouseenter)="onMouseEnter($event)"
      (mouseleave)="onMouseLeave()"
      [matTooltip]="sidebarCollapsed() && level() === 0 ? getTooltipText() : ''"
      matTooltipPosition="right"
      [matTooltipDisabled]="!sidebarCollapsed() || level() > 0"
      matRipple>

      @if (item().icon) {
        <mat-icon class="nav-icon">{{ item().icon }}</mat-icon>
      }

      @if (!sidebarCollapsed() || level() > 0) {
        <span class="nav-title">{{ item().title }}</span>

        <mat-icon class="nav-arrow" [class.open]="isOpen()">
          keyboard_arrow_down
        </mat-icon>
      }
    </div>

    @if (!sidebarCollapsed() || level() > 0) {
      <div class="nav-children" [class.open]="isOpen()">
        @for (child of item().children; track child.id) {
          <app-nav-item
            [item]="child"
            [level]="level() + 1"
            [sidebarCollapsed]="sidebarCollapsed()"
            [inFloatingSubmenu]="inFloatingSubmenu()">
          </app-nav-item>
        }
      </div>
    }

    @if (sidebarCollapsed() && level() === 0 && showSubmenu()) {
      <div
        class="floating-submenu"
        [style.top.px]="submenuPosition().top"
        [style.left.px]="submenuPosition().left"
        (mouseenter)="onSubmenuMouseEnter()"
        (mouseleave)="onSubmenuMouseLeave()">
        <div class="submenu-header">
          @if (item().icon) {
            <mat-icon>{{ item().icon }}</mat-icon>
          }
          <span>{{ item().title }}</span>
        </div>
        <div class="submenu-items">
          @for (child of item().children; track child.id) {
            <app-nav-item
              [item]="child"
              [level]="1"
              [sidebarCollapsed]="false"
              [inFloatingSubmenu]="true">
            </app-nav-item>
          }
        </div>
      </div>
    }
  }

  @if (item().type === 'item') {
    <a
      class="nav-item nav-link"
      [style.padding-left]="sidebarCollapsed() && level() === 0 ? '12px' : getPaddingLeft()"
      [routerLink]="item().url"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{exact: false}"
      (click)="onItemClick()"
      [matTooltip]="sidebarCollapsed() && level() === 0 ? getTooltipText() : ''"
      matTooltipPosition="right"
      [matTooltipDisabled]="!sidebarCollapsed() || level() > 0"
      matRipple>

      @if (item().icon) {
        <mat-icon class="nav-icon">{{ item().icon }}</mat-icon>
      }

      @if (!sidebarCollapsed() || level() > 0) {
        <span class="nav-title">{{ item().title }}</span>

        @if (item().badge) {
          <span class="nav-badge {{ item().badge!.bg }} {{ item().badge!.fg }}">
            {{ item().badge!.title }}
          </span>
        }
      }
    </a>
  }
</div>

