<mat-tree #tree [dataSource]="data()" [childrenAccessor]="childrenAccessor" class="nav-tree">
  <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodeToggle [cdkTreeNodeTypeaheadLabel]="node.title" class="min-h-11"
     [class.parent-active]="isParentOfActive(node)">
    <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.title">
      <mat-icon>{{ tree.isExpanded(node) ? 'expand_more' : 'chevron_right' }}</mat-icon>
    </button>
    <div class="tree-node-content flex items-center gap-3 px-3 py-2 cursor-pointer rounded-lg flex-1 transition-colors duration-200"
         [matTooltip]="node.title"
         matTooltipPosition="right">
      @if (node.icon) {
        <mat-icon class="text-xl w-5 h-5">{{ node.icon }}</mat-icon>
      }
      <span class="flex-1 text-sm line-clamp-2">{{ node.title }}</span>
      @if (getTotalBadgeCount(node) > 0 && !tree.isExpanded(node)) {
        <span class="app-badge normal">{{ getTotalBadgeCount(node) }}</span>
      }
    </div>
  </mat-tree-node>
  <mat-tree-node *matTreeNodeDef="let node" class="min-h-11" [class.active]="isActive(node.url)">
    <button mat-icon-button disabled class="opacity-0 pointer-events-none"></button>
    <div class="tree-node-content flex items-center gap-3 px-3 py-2 cursor-pointer rounded-lg flex-1 transition-colors duration-200" (click)="navigate(node)" [matTooltip]="node.title" matTooltipPosition="right">
      @if (node.icon) {
        <mat-icon class="text-xl w-5 h-5">{{ node.icon }}</mat-icon>
      }
      <span class="flex-1 text-sm line-clamp-2">{{ node.title }}</span>
      @if (node.badge) {
        <span class="app-badge"
              [ngClass]="[ node.badge.type, node.badge.indicator ? 'has-indicator' : '' ]">
          {{ node.badge.title }}
        </span>
      }
    </div>
  </mat-tree-node>
</mat-tree>
