<div [class]="criteriaAreaClasses()" aria-label="Filtros activos" aria-live="polite"
     class="flex flex-wrap gap-2 p-3.5 min-h-[52px] items-center" role="list">

  @if (!hasCriteria()) {
    <mat-icon>filter_list</mat-icon>
    <span>No hay filtros aplicados</span>
  } @else {
    @for (criterion of criteria(); track criterion.id) {
      <div [attr.data-type]="criterion.field.type" class="app-filter-pill" role="listitem">
        <span class="app-filter-pill-field">{{ criterion.field.label }}</span>
        <span class="app-filter-pill-operator">{{ criterion.operator.symbol }}</span>
        <span [title]="criterion | criterionDisplay" class="app-filter-pill-value">
          {{ criterion | criterionDisplay }}
        </span>
        <button (click)="removeCriterion(criterion.id)" [attr.aria-label]="'Eliminar filtro: ' + criterion.field.label + ' ' + criterion.operator.symbol + ' ' + (criterion | criterionDisplay)"
                class="app-filter-pill-remove"
                type="button">
          <mat-icon aria-hidden="true">close</mat-icon>
        </button>
      </div>
    }
  }
</div>

<mat-divider class="my-4"></mat-divider>

<div [formGroup]="builderForm" class="app-filters-advanced-form">
  <div>
    <app-form-select [config]="{ label: 'Campo' }" [options]="fieldOptions()" appFormSelectConnector
                     formControlName="field">
    </app-form-select>
  </div>

  <div>
    <app-form-select [config]="{ label: 'Operador' }" [options]="operatorOptions()" appFormSelectConnector
                     formControlName="operator">
    </app-form-select>
  </div>

  @if (selectedField() && !isNoValueOperator()) {
    <div>
      @switch (selectedFieldType()) {
        @case ('select') {
          <app-form-select [config]="{ label: 'Valor' }" [options]="valueOptions()" appFormSelectConnector
                           formControlName="value">
          </app-form-select>
        }
        @case ('date') {
          <app-form-datepicker [config]="{ label: 'Fecha' }" appFormDatepickerConnector
                               formControlName="value"></app-form-datepicker>
        }
        @case ('number') {
          <app-form-input [config]="{ label: 'Valor' }" appFormInputConnector formControlName="value"
                          type="number"></app-form-input>
        }
        @case ('boolean') {
          <app-form-select [config]="{ label: 'Valor' }" [options]="booleanOptions" appFormSelectConnector
                           formControlName="value">
          </app-form-select>
        }
        @default {
          <app-form-input [config]="{ label: 'Valor' }" appFormInputConnector formControlName="value"></app-form-input>
        }
      }
    </div>
  } @else {
    <div></div>
  }

  <div class="app-filters-advanced-form-button">
    <app-button (click)="addCriterion()" [disabled]="!canAddCriterion()" iconBefore="add">
      Agregar
    </app-button>
  </div>
</div>

<app-filter-footer
  (clearClick)="clearAllCriteria()"
  (searchClick)="emitSearch()"
  (toggleChange)="onToggleChange($event)"
  [showClearButton]="showClearButton()"
  [showSearchButton]="showSearchButton()"
  [toggles]="toggles()">
</app-filter-footer>
